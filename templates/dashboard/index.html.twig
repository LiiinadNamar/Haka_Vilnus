{% extends 'base.html.twig' %}

{% block title %}Ticket Dashboard{% endblock %}

{% block body %}
    <div class="container mt-5">
        <div id="dashboard-section" class="page-section active">
            <div class="container-fluid p-4">
                <div class="row justify-content-center">
                    <div class="col-12 col-xl-10">
                        <div class="d-flex align-items-center justify-content-between mb-4">
                            <h1 class="fade-in mb-0">Ticket Dashboard</h1>
                            <div class="d-flex gap-2">
                                <a href="{{ path('app_label_index') }}" class="btn btn-outline-primary">
                                    <i class="bi bi-tags"></i> Manage Labels
                                </a>
                                <a href="{{ path('app_priority_index') }}" class="btn btn-outline-success">
                                    <i class="bi bi-flag"></i> Manage Priorities
                                </a>
                            </div>
                        </div>
                        <div id="tickets-container" class="row g-3">
                            {% for issue in issues %}
                            <div class="col-12">
                                <a href="{{ path('app_messages', {'issueId': issue.id}) }}" class="text-decoration-none">
                                    <div class="card ticket-card bg-white" style="border-left: 4px solid {{ issue.priority and issue.priority.color ? issue.priority.color : '#6c757d' }}; transition: transform 0.2s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                        <div class="card-body">
                                            <div class="d-flex align-items-center gap-3">
                                            <!-- ID -->
                                            <span class="text-muted flex-shrink-0">#{{ issue.id }}</span>

                                            <!-- Title and Description -->
                                            <div class="flex-grow-1 min-width-0">
                                                <div class="d-flex align-items-center gap-2">
                                                    <h6 class="card-title mb-0 text-truncate">{{ issue.title }}</h6>
                                                    {% if issue.summary %}
                                                    <span class="text-muted">-</span>
                                                    <p class="card-text text-muted mb-0 text-truncate">{{ issue.summary }}</p>
                                                    {% endif %}
                                                </div>
                                            </div>

                                            <!-- Labels -->
                                            <div class="d-flex gap-2 flex-shrink-0">
                                                {% for label in issue.labels %}
                                                <span class="badge label-badge" style="background: none; background-color: {{ label.color }} !important; color: white;">
                                                    {{ label.name }}
                                                </span>
                                                {% endfor %}
                                            </div>

                                            <!-- Priority circle -->
                                            <div class="priority-circle flex-shrink-0" style="background-color: {{ issue.priority and issue.priority.color ? issue.priority.color : '#6c757d' }}; color: white;">
                                                {{ issue.priority ? issue.priority.number : 1 }}
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
